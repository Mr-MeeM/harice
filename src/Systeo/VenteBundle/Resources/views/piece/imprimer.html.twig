

<style>
    {%set color= config.couleur1 %}
    {%set border="#666"%}

    span.coordonnees{
        font-weight: bold;
        color: {{color}};
    }
    .div_affich{
        width: 400px;
    }
    #logo{
        width:400px;
        position: absolute;
    }
    #logo img{
        height: 90px;
        width: auto;
    }

    #coordonnees{
        width:330px;
        position: absolute;
        left: 410px;
    }
    #client-name{
        position: absolute;
        top: 90px;
        border: 1px solid {{border}};
        padding: 10px;
        width: 380px;
        height: 80px;
    }
    #date-client-facture{                
        position: absolute;
        top: 90px;
        left: 410px;
        width: 310px;
        display: block;
        border-top: 1px solid {{border}};
        border-left: 1px solid {{border}};
    }
    #typepiececommerciale{
        font-weight: bold;
        font-size: 40px;
        position: absolute;
        top: 200px;
    }
    th.titre-dcf{
        padding: 11px 5px;
        font-weight: bold;
        border-right:1px solid {{border}};
        border-bottom: 1px solid {{border}};
        text-align: left;
        width:30%;
    }
    td.contenu-dcf{
        padding: 5px;
        border-right:1px solid {{border}};
        border-bottom: 1px solid {{border}};
        text-align: left;
        width:70%;
        vertical-align: middle;
    }

    #ul-coordonnees{
        list-style: none;
        margin-left: -32px;
    }
    #ul-coordonnees li{
        height: 19px;
    }
    .coordonnees{
        font-weight: bold;
    }
    .columns{
        position: absolute;
        top:250px;
        border-right: 1px solid {{border}};
        height: 400px;
    }

    .columns_final{
        position: absolute;
        top:250px;
        border-right: 1px solid {{border}};
        border-bottom: 1px solid {{border}};
        height: 400px;
    }
    td.ligne_header{
        font-weight: bold;
        padding: 5px 5px;
        border-bottom: 1px solid {{border}};
        height: 10px;
    }

    #lignes-pieces{
        position: absolute;
        top: 250px;
        border-top: 1px solid {{border}};
        width:700px;
    }

    #totaux-base-tva{
        position: absolute;
        top: 660px;
        border-top:1PX SOLID {{border}};
        border-left:1PX SOLID {{border}};
        width: 300px;
    }
    #totaux-generaux{
        position: absolute;
        top: 660px;
        left: 350px;
        border-top:1PX SOLID {{border}};
        border-left:1PX SOLID {{border}};
    }
    td.libelle_total_droite{
        padding: 7px 5px;
        border-right:1px solid {{border}};
        border-bottom: 1px solid {{border}};
        text-align: left;
        font-weight: bold;
        width: 165px;
    }
    td.donne_total_droite{
        padding: 7px 5px;
        border-right:1px solid {{border}};
        border-bottom: 1px solid {{border}};
        text-align: right;
        width: 160px;
    }
    td.tva_porcentage, td.tva_montant{
        padding: 5px;
        border-right:1px solid {{border}};
        border-bottom: 1px solid {{border}};
        text-align: center;
        width: 50%;
    }
    td.line_content{
        padding: 5px 5px;
        height: auto;
    }
    #montant-en-toutes-lettre{
        border: 1px solid {{border}};
        padding: 10px;
        width: 320px;
        position: absolute;
        top: 820px;
        height: 100px;
    }

    #cachet-signature{
        border: 1px solid {{border}};
        padding: 10px;
        width: 348px;
        position: absolute;
        left: 350px;
        top: 820px;
        height: 100px;
        font-weight: bold;
    }
    #coordonnees-footer{
        text-align: center;
        position: absolute;
        top: 950px;
        padding: 10px;
        width:700px;
        border-top: 2px solid {{color}};
        font-size: 14px;
    }
</style>
{% set page_courant=1 %}
{%for t_ligne in tab_ligne_piece%}
    <page>
        <div id="logo">
            {% if config.logo is not null %}
                <img src="{{server}}{{asset('files/Parametres/')}}{{config.logo}}">
            {% endif %}
        </div>
        <div id="coordonnees">
            <ul id="ul-coordonnees">
                {%if config.tel != ""%}<li><span class="coordonnees">Tél :</span> {{config.tel}}<br /></li>{%endif%}
                {%if config.fax != ""%}<li><span class="coordonnees">Fax :</span> {{config.fax}}<br /></li>{%endif%}
                {%if config.email != ""%}<li><span class="coordonnees">Email :</span> {{config.email}}</li>{%endif%}
                {%if config.web != ""%}<li><span class="coordonnees">Site web :</span> {{config.web}}</li>{%endif%}
            </ul>
        </div>
        <div id="client-name">
            <b>{{piece.tierName}}</b>
            <BR /><BR />
            {%if piece.tierMf != ""%}
                <b>Matricule Fiscale :</b> {{piece.tierMf}}<br>
            {%endif%}
            <br />
            {%if piece.tierAdresse != ""%}
                <b>Adresse : </b>{{piece.tierAdresse}}
            {%endif%}
        </div>
        <div id="date-client-facture">
            <table cellpadding="0" cellspacing="0" >
                <tr>
                    <th class="titre-dcf">{{piece.type}} N°</th>
                    <td class="contenu-dcf">
                        {%set prefix=''%}
                        {%if piece.numero != ""%}
                            {%for i in 0..(3-piece.numero|length)%}
                                {%set prefix=prefix~'0'%}
                            {%endfor%}
                        {%endif%}
                        {{prefix}}{{piece.numero}}/{%if piece.date%}{{piece.date|date('Y')}}{%endif%}
                    </td>
                </tr>
                <tr>
                    <th class="titre-dcf">Date</th>
                    <td class="contenu-dcf">
                        {%if piece.date%}{{piece.date|date('d/m/Y')}}{%endif%}
                    </td>
                </tr>
                <tr>
                    <th class="titre-dcf">Client N°</th>
                    <td class="contenu-dcf">
                        CL-0{{piece.tier.id}}
                    </td>
                </tr>
                <tr>
                    <th class="titre-dcf">Page</th>
                    <td class="contenu-dcf">
                        {{page_courant}}/{{ nombre_page }}
                    </td>
                </tr>
            </table>
        </div>

        <div id="typepiececommerciale">
            {{piece.type}}
        </div>
        <div class="columns" style="width:1px;"></div>
        <div class="columns" style="width:60px;"></div>
        <div class="columns" style="width:380px;"></div>
        <div class="columns" style="width:430px;"></div>
        <div class="columns" style="width:540px;"></div>
        <div class="columns" style="width:610px;"></div>
        <div class="columns_final" style="width:720px;"></div>
        <table cellpadding="0" cellspacing="0" id="lignes-pieces">
            <col style="width: 45px;" >
            <col style="width: 280px;" >
            <col style="width: 45px;">
            <col style="width: 70px;">
            <col style="width: 60px;">
            <col style="width: 70px;">
            <tr>
                <td  class="ligne_header" style="text-align:center;">Code</td>
                <td class="ligne_header" style="text-align:left;padding-left: 10px;">Désignation</td>
                <td class="ligne_header"  style="text-align:center;">Qté</td>
                <td class="ligne_header" style="text-align:right;">Prix HT</td>
                <td class="ligne_header"  style="text-align:center;">TVA(%)</td>
                <td class="ligne_header"  style="text-align:right;">Total HT</td></tr>
                {%for ligne in t_ligne%}
                <tr>
                    <td class="line_content" valign="top" style="text-align:center;">{{ligne.code}}</td>
                    <td class="line_content" valign="top" style="text-align:left;padding-left: 10px;">{{ligne.name|raw}}</td>
                    <td class="line_content" valign="top" style="text-align:center;">{{ligne.quantite}}</td>
                    <td class="line_content" valign="top" style="text-align:right;padding-right: 10px;">{%if ligne.prixHt%}{{ligne.prixHt|number_format(3, '.', ' ')}}{%endif%}</td>
                    <td class="line_content" valign="top" style="text-align:center;">{{ligne.tauxTva}}</td>
                    <td class="line_content" valign="top" style="text-align:right;padding-right: 10px;">{%if ligne.totalHt%}{{ligne.totalHt|number_format(3, '.', ' ')}}{%endif%}</td>
                </tr>
            {%endfor%}
        </table>
        {% if page_courant== nombre_page %}
            <div id="totaux-base-tva">
                <table cellpadding="0" cellspacing="0" >
                    <tr>
                        <td class="tva_porcentage">
                            <b>TVA</b>
                        </td>
                        <td class="tva_montant">
                            <b>Montant</b>
                        </td>
                    </tr>
                    {%for key,base in base_tva%}
                        {%if base != 0%}
                            <tr>
                                <td class="tva_porcentage">{{key}}</td>
                                <td class="tva_montant" nowrap>{%if base%}{{base|number_format(3, '.', ' ')}}{%endif%}</td>
                            </tr>
                        {%else%}
                            <tr>
                                <td class="tva_porcentage">0.00</td>
                                <td class="tva_montant" nowrap>0.000</td>
                            </tr>
                        {%endif%}
                    {%endfor%}
                </table>
            </div>
            <table cellpadding="0" cellspacing="0" id="totaux-generaux">
                <tr>
                    <td class="libelle_total_droite">
                        Montant HT
                    </td>
                    <td class="donne_total_droite">{%if piece.montantHt%}{{piece.montantHt|number_format(3, '.', ' ')}} TND{%endif%}</td>
                </tr>
                {% if tauxFodec is not null %}
                    <tr>
                        <td class="libelle_total_droite">
                            Montant FODEC
                        </td>
                        <td class="donne_total_droite">{%if piece.montantFodec%}{{piece.montantFodec|number_format(3, '.', ' ')}} TND{%endif%}</td>
                    </tr>
                {%endif%}
                <tr>
                    <td class="libelle_total_droite">
                        Total TVA
                    </td>
                    <td class="donne_total_droite">
                        {%if piece.montantTva%}{{piece.montantTva|number_format(3, '.', ' ')}} TND{%endif%}
                    </td>
                </tr>
                <tr>
                    <td class="libelle_total_droite">Droit de Timbre</td>
                    <td class="donne_total_droite">
                        {%if piece.montantTimbre%}{{piece.montantTimbre|number_format(3, '.', ' ')}} TND{%endif%}
                    </td>
                </tr>
                <tr>
                    <td class="libelle_total_droite">Montant TTC</td>
                    <td class="donne_total_droite">
                        {%if piece.montantTtc%}{{piece.montantTtc|number_format(3, '.', ' ')}} TND{%endif%}
                    </td>
                </tr>
            </table>
            <div id="montant-en-toutes-lettre" class="margin-fodec">
                {%if piece.type == "Facture" %}
                    Arrêtée la présente facture la somme de 
                {%elseif piece.type == "Devis" %}
                    Arrêtée le présent devis la somme de 
                {%elseif piece.type == "Avoir" %}
                    Arrêtée la présente avoir la somme de 
                {%endif%}
                {{montant_en_toute_lettre}}
            </div>
            <div id="cachet-signature" class="margin-fodec">
                Cachet & Signature
            </div>

        {% else %}
            <div id="totaux-base-tva">
                <table cellpadding="0" cellspacing="0" >
                    <tr>
                        <td class="tva_porcentage">
                            <b>TVA</b>
                        </td>
                        <td class="tva_montant">
                            <b>Montant</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="tva_porcentage">0.00</td>
                        <td class="tva_montant" nowrap>0.000</td>
                    </tr>
                </table>
            </div>
            <table cellpadding="0" cellspacing="0" id="totaux-generaux">
                <tr>
                    <td class="libelle_total_droite">
                        Montant HT
                    </td>
                    <td class="donne_total_droite">0.000 TND</td>
                </tr>
                {% if tauxFodec is not null %}
                    <tr>
                        <td class="libelle_total_droite">
                            Montant FODEC
                        </td>
                        <td class="donne_total_droite">0.000 TND</td>
                    </tr>
                {%endif%}
                <tr>
                    <td class="libelle_total_droite">
                        Total TVA
                    </td>
                    <td class="donne_total_droite">
                        0.000 TND
                    </td>
                </tr>
                <tr>
                    <td class="libelle_total_droite">Droit de Timbre</td>
                    <td class="donne_total_droite">
                        0.000 TND
                    </td>
                </tr>
                <tr>
                    <td class="libelle_total_droite">Montant TTC</td>
                    <td class="donne_total_droite">
                        0.000 TND
                    </td>
                </tr>
            </table>
            <div id="montant-en-toutes-lettre" class="margin-fodec">
            </div>
            <div id="cachet-signature" class="margin-fodec">
                Cachet & Signature
            </div>

        {% endif %}
            <div id="coordonnees-footer" class="margin-fodec" style="text-align: center;">
                {%if config.mf != "" %}<b>Code TVA:</b>{{config.mf}} – {%endif%}
                {%if config.rc != "" %}<b>Registre de commerce:</b>{{config.rc}} – {%endif%}
                {%if config.cd != "" %}<b>Code en Douane:</b>{{config.cd}}{%endif%}<br>
                {%if config.adresse != "" %}<b>Adresse:</b>{{config.adresse}}{%endif%}
            </div>
    </page>

    {% set page_courant=page_courant+1 %}
{% endfor %}